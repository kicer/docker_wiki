# sensir甲醛检测仪
检测甲醛TVOC、18650锂电池、灯光报警、蜂鸣器提醒、数码管显示数值。开机120s后显示数值，采用动态比对修正值，一直趋向于0.01，实用意义不大。

## 来源
[森sir甲醛检测仪家用型](https://item.taobao.com/item.htm?id=575402081523)

## 拆解
包装说明完整，配置有数据线，包装盒内衬纸损坏严重。产品到手感觉质量一般，外壳瑕疵较多，桌面放置看中规中矩。

#### 组成部件

```
* 18650锂电池
* 显示窗为PVC贴纸
* 按键按压后下陷，观感差
* 壳体材料颜色不一致，前后盖偏差较多
* 电池仓盖翘起，容易损坏
```

![部件拆解](/images/work/sensor/f205eb237218e69d.jpg)

#### 电路分析
电路部分整体一般，国产TVOC探头+N76E003串口直接输出检测数值（探头厂家私有方案？）。主控sop16芯片未知（非STC），独立的充电保护芯片。

```
* 3位0.4寸白色数码管
* 原为3色彩灯，pwm控制亮度等级作小夜灯
* 未知型号TVOC探头+报警小喇叭
```

![电路板正面](/images/work/sensor/c851cb4872e29959.jpg)

```
* 电源开关
* 电池升压5v后供给TVOC探头
* 5v降压至3.3v供给74HC595、主控芯片
* TP4063充电芯片+电池负极的充电保护芯片
```

![电路板反面](/images/work/sensor/cfb65b9aa6376d98.jpg)

## 改造 *FAIL!*
电路板与后盖空间足够大，加入WiFi模块足够使用。考虑最小化成本，不做完全改造，保留原电路板直接扩展。
由于未能查找到对应的主控芯片，拆换后通过1.27双排针引出所有控制引脚，尝试用esp12F模块直接全部控制。
主要为扩展：`315MHz接收模块`及`温湿度芯片`。

#### 遇到的问题

* 喇叭IO直接驱动报警功能（已完成）
* 74HC595软IO驱动，轮扫3位数码管，最小间隔需6ms（已完成）
* H3V3E射频模块需要IO中断来解析数据，干扰巨大！中断狂触发（已完成）

> * 射频解析遇负载超限时，无法及时调度IO中断任务
* 数码管扫描遇负载超限时，刷新延后导致闪烁
* 集合后发现系统负载过高，无法正常调度，射频模块无法解析数据

![改造](/images/work/sensor/c54ce3d0e1dd3255.jpg)

## 思考
基于下面这些因素，加独立单片机配合WiFi模组分工协作是合理实现方案。

* 数码管建议用TM1650类的芯片，直接驱动无需耗费资源扫描（能耗高且效果差）
* AD测量直接用esp8266不合适，有效范围太小（0-1v）
* 射频模块接收数据需要强实时操作
* TVOC探头质量较差，选用小型MEMS(MISC-5524)或CO2传感器较合适
